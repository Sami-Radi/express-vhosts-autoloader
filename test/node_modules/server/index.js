module.exports.app = (() => {
  var express = require('express');
  return express();
})()

module.exports.dirname = (() => {
  return require('path').dirname(module.filename);
})();

module.exports.start = (done) => {
  module.exports.stop(done);
  var port = process.env['PORT'] || 8080;
  var server = module.exports.app.listen( port, () => {
    console.log( '* Test server listening on port %d ', port );
  });
  module.exports.server = server;
  return server;
};

module.exports.stop = (done) => {
  if(module.exports.server){
    var port = process.env['PORT'] || 8080;
    console.log( '* Test server on port %d closed', port );
    module.exports.server.close(done);
  };
};