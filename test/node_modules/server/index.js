module.exports.app = (() => {
  express
  var express = require('express');
  return express();
})()

module.exports.dirname = (() => {
  return require('path').dirname(module.filename);
})();

module.exports.start = (onListenning) => {
  var port = process.env['PORT'] || 8080;
  var server = module.exports.app.listen( port, () => {
    console.log( '* Test server listening on port %d.', port );
    onListenning(module.exports.app);
  });
  module.exports.server = server;
  return server;
};

module.exports.stop = (onClosed) => {
  if(module.exports.server){
    var port = process.env['PORT'] || 8080;
    console.log( '* Test server on port %d closed.', port );
    module.exports.server.close(onClosed);
  } else {
    console.log( '* No test server to close.');
    onClosed();
  };
};